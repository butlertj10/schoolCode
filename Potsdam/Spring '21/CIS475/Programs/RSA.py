import sys
import string
import random

p =  97641456984591925339904023927243116853806690076106105721919297924340159682384822159975113389946798104415482792128757035012658965281152626875179338026046694639151325289033593243746598486889943993892785357391970752939629565181517223888204725272436990773833112488841756443489703088186349701408157811589967263737
q =  66285211806534251891380633225494760878065106751216406805429441089898194431782837803067826877956379899474881594316505227821764191106832306710852153124544450117325840174412222430007645781511521191029285541866143237757339411161820578087436228689930614885000028022523211369495756185687087712249781962944965737659

def split(word):
    return [ord(char)**e % n for char in word]

def split2(word):
    return [char for char in word]

def split3(word):
    return [ord(char)**myE % myN for char in word]

# phi, e
def gcd(a,b):
    if(b==0):
        return a
    else:
        return gcd(b,a%b)

def pulv(A, B):
    Q , R = divmod(A, B)
    x1 = 1
    y1 = 0
    x2 = 0
    y2 = 1
    while (R != 0):
        A = B
        B = R
        tempx2 = x2
        tempy2 = y2
        x2 = x1 - (Q * x2)
        y2 = y1 - (Q * y2)
        x1 = tempx2
        y1 = tempy2
        Q , R = divmod(A, B)
    if (y2 < 0):
        return myPhi - abs(y2)
    return y2

# INITIALIZING VARIABLES
n = 501131490825910275522812288218612956164577816083973169746903604353226984992937440229212071122485933375147208985799822891260291199336623060458430678947003757375066403403028604452413899359443157869010155446194212350852238381703832074004018217147542045711753654236220028168528971734507968350148295291368804218783857684634851269416386402693370685523187849164561614148580179773161019326569306064863780950851184444436755464634217528202328367766428205101686713669754857877990280613316979170141958750683048269331035991088038146553350434952162831926693280223813149811541364777419147135453256050103463343066331561611100341655643878388284784369694888546542157082074309445602877118625799443345156977607985937896004683027094991738234045494550424449165022839208746326936572513796469350086684800201428823979335253184348099469409541500448041823590470287137465734676949475028317128038000393156901037654009954675774113563807430653632118527551628858071534488318046950268205833664323070566072846238778983281754449988699535212414717416522829057230912776803219800960647272089035265255381163810563604540454437185711425924314155698367876154434712603070428963965653947223089685973961466324067584083036692469456672568975727136389523024480634853954614965347589
e = 607

# ACQUIRING TWO RANDOM PRIMES FOR P AND Q
print("P = ", p)
print("Q = ", q)
myN = p * q
myPhi = (p - 1) * (q - 1)

# CALCULATING E  
GCDcheck = 0
myE = 29384
while GCDcheck == 0:
    if gcd(myPhi, myE) != 1:
        myE = myE + 1
    else:
        GCDcheck = 1
        print("E = ", myE)

# CALCULATING D
myD = pulv(myPhi, myE) % myPhi
word = string.printable
file1 = open('RSAcoded.txt', 'r')
file2 = open('MyRSA.txt', 'w+')
file3 = open('MyRSACipher.txt', 'w+')
file4 = open('TestingRSA.txt', 'w+')

while True:
    line = file1.readline()
    if not line:
        break
    asc = split(word).index(int(line.strip()))
    # print(split2(word)[asc])
    file2.writelines(split2(word)[asc])

    newCipher = str((asc**myE) % myN )
    file3.writelines(newCipher)
    file3.writelines("\n")

    newscript = pow(int(newCipher), myD, myN)
    file4.writelines(split2(word)[newscript])
    # print(split2(word)[newscript])


print("N = ", myN)
print("E = ", myE)
print("D = ", myD)

file1.close()
file2.close()